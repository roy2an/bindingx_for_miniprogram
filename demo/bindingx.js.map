{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/binding.js","webpack:///./src/bindingx.js","webpack:///./src/lib/expression.js","webpack:///./src/lib/fn.js","webpack:///./src/lib/handlers/animation-util/bezier.js","webpack:///./src/lib/handlers/animation-util/easing.js","webpack:///./src/lib/handlers/animation-util/index.js","webpack:///./src/lib/handlers/animation-util/raf.js","webpack:///./src/lib/handlers/animation-util/timer.js","webpack:///./src/lib/handlers/index.js","webpack:///./src/lib/handlers/timing.js","webpack:///./src/parser/parse.js"],"names":[],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACa;;AAEY;AACgB;AACS;;AAElD;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,UAAU;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,iEAAa;AAC9C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,SAAS,OAAO;AAChB,iDAAiD;AACjD;AACA;;AAEA;AACA,WAAW,uDAAU,mCAAmC,+CAAE;AAC1D;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,gBAAgB;AAC3B;AACA;AACA;AACA;AACA,oBAAoB,YAAY;AAChC;;AAEA;AACA;AACA;;AAEA;;AAEe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,YAAY;AACZ,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;AACH,C;;;;;;;;;;;;ACpHA;AAAA;AAAA;AAAA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACa;;AAEsB;AACJ;;AAE/B;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,iEAAiE,qDAAM;AACvE;AACA;;AAEe;AACf;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,OAAO;AACP;;AAEA,WAAW,gDAAO;AAClB,GAAG;AACH;AACA;AACA;AACA;AACA,WAAW,gDAAO;AAClB,GAAG;AACH;AACA,WAAW,gDAAO;AAClB;AACA,C;;;;;;;;;;;;AChEA;AAAA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEb;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,0BAA0B;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEe;AACf;AACA,CAAC,E;;;;;;;;;;;;AChHD;AAAA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB,oBAAoB;AACrC;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,aAAa,OAAO,EAAE,OAAO;AAC7B,aAAa,OAAO,EAAE,OAAO;AAC7B,aAAa,OAAO,EAAE,OAAO;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,YAAY,GAAG,YAAY,GAAG,YAAY;AAC5D,GAAG;AACH;AACA,kBAAkB,YAAY,GAAG,YAAY,GAAG,YAAY,GAAG,EAAE;AACjE,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,iBAAiB;AAChC,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEe,iEAAE,E;;;;;;;;;;;AC5GjB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;AChEa;;AAEb,KAAK,wBAAwB;AAC7B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;;;AAGA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA,wB;;;;;;;;;;;AC7IA,iBAAiB,mBAAO,CAAC,2DAAS,E;;;;;;;;;;;;ACArB;;AAEb;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACXa;;AAEb,aAAa,mBAAO,CAAC,6DAAU;AAC/B,aAAa,mBAAO,CAAC,6DAAU;AAC/B,KAAK,eAAe,GAAG,mBAAO,CAAC,uDAAO;;;AAGtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA,SAAS,yBAAyB;AAClC;AACA;AACA,2CAA2C,WAAW;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,8BAA8B;AAC3E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA,SAAS,cAAc;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;;AAEA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA,KAAK;AACL,GAAG;;AAEH;AACA,SAAS,MAAM;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;AC/HA;AAAA;AAAA;AAAA;AAAqC;;;;;;;;;;;;;ACArC;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEkC;;AAEhC;AACf;AACA;AACA,SAAS,2BAA2B;;AAEpC;AACA,WAAW,WAAW;AACtB;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,yCAAyC,4DAAS;AAClD;AACA;AACA;AACA,+BAA+B,qBAAqB;AACpD,OAAO;AACP;AACA,sDAAsD,OAAO;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT;AACA,+BAA+B,qCAAqC;AACpE,OAAO;AACP;AACA,+BAA+B,kCAAkC;AACjE;AACA,KAAK;AACL;AACA;;AAEA;AACA,SAAS,wBAAwB;AACjC,uCAAuC,EAAE;AACzC,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;;AAEA,C;;;;;;;;;;;;AC7EA;AAAA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kHAAkH,mCAAmC,0BAA0B;AAC/K;AACA,gGAAgG,IAAI;AACpG,oGAAoG,EAAE,gBAAgB,EAAE,6HAA6H,EAAE,gBAAgB,EAAE;AACzQ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,4BAA4B;AAC/C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD;AAChD,yCAAyC,KAAK;AAC9C;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,qJAAqJ,KAAK,8BAA8B;AACxL;AACA;AACA,oDAAoD;AACpD,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL,qBAAqB,8BAA8B;AACnD;AACA;;AAEA;;;AAGA;AACA;;AAEA,yDAAyD;AACzD;AACA;AACA;AACA;AACA;;AAEA,KAAK,8DAA8D;AACnE;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK,8CAA8C;AACnD;AACA;AACA;;AAEA,KAAK,sDAAsD;AAC3D;AACA;AACA;AACA,KAAK;AACL,qBAAqB,8BAA8B;AACnD;AACA;AACA;;;AAGA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEe;AACf;AACA,C","file":"bindingx.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/bindingx.js\");\n","/**\n Copyright 2018 Alibaba Group\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n'use strict';\n\nimport Fn from './lib/fn'\nimport Expression from './lib/expression'\nimport {TimingHandler} from './lib/handlers/index'\n\nclass Binding {\n  constructor(options, callback, animation) {\n    this.options = options;\n    this.callback = callback;\n    this.token = this.genToken();\n    this.animation = animation || this.genAnimation();\n    let {eventType} = options;\n    switch (eventType) {\n      // case 'pan':\n      //   this._eventHandler = new PanHandler(this);\n      //   break;\n      // case 'orientation':\n      //   this._eventHandler = new OrientationHandler(this);\n      //   break;\n      case 'timing':\n        this._eventHandler = new TimingHandler(this);\n        break;\n      // case 'scroll':\n      //   this._eventHandler = new ScrollHandler(this);\n      //   break;\n    }\n  }\n\n  genAnimation() {\n    let {config} = this.options\n    let animation = wx.createAnimation(config||{})\n    return animation;\n  }\n\n  getValue(params, expression) {\n    return Expression.execute(expression, Object.assign(Fn, params));\n  }\n\n  genToken() {\n    return parseInt(Math.random() * 10000000);\n  }\n\n  setProperty(changes) {\n    let animation = this.animation\n    while (changes.length) {\n      let {property, value} = changes.shift()\n      let ps = property.split('.')\n      let p = ps[ps.length - 1]\n      animation = animation[p](value)\n    }\n    animation.step({duration: 0})\n  }\n\n  destroy() {\n    this._eventHandler.destroy();\n  }\n\n}\n\nexport default {\n  _bindingInstances: [],\n  bind (options, callback, animation) {\n    if (!options) {\n      throw new Error('should pass options for binding');\n    }\n    let existInstances = this._bindingInstances.filter((instance) => {\n      if (options.anchor) {\n        return instance.options.anchor === options.anchor && instance.options.eventType === options.eventType;\n      }\n    });\n    // 销毁上次实例\n    if (existInstances) {\n      existInstances.forEach((inst) => {\n        inst.destroy();\n        this._bindingInstances.splice(this._bindingInstances.indexOf(inst), 1)\n      });\n    }\n    let binding = new Binding(options, callback, animation);\n    this._bindingInstances.push(binding);\n    return {token: binding.token, animation: binding.animation};\n  },\n  unbind(options) {\n    if (!options) {\n      throw new Error('should pass options for binding');\n    }\n    let inst = this._bindingInstances.find((instance) => {\n      return instance.options.eventType === options.eventType && instance.token === options.token;\n    });\n    if (inst) {\n      inst.destroy();\n    }\n  },\n  unbindAll() {\n    this._bindingInstances.forEach((inst) => {\n      inst.destroy({\n        eventType: inst.options.eventType,\n        token: inst.token\n      });\n    });\n  },\n}","/**\n Copyright 2018 Alibaba Group\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n'use strict';\n\nimport Parser from './parser/parse'\nimport Binding from './binding'\n\nfunction formatExpression (expression) {\n  if (expression === undefined) return;\n  try {\n    expression = JSON.parse(expression);\n  } catch (err) {\n\n  }\n  let resultExpression = {};\n  if (typeof expression === 'string') {\n    resultExpression.origin = expression;\n  } else if (expression) {\n    resultExpression.origin = expression.origin;\n    resultExpression.transformed = expression.transformed;\n  }\n  if (!resultExpression.transformed && !resultExpression.origin) return;\n  resultExpression.transformed = resultExpression.transformed || Parser.parse(resultExpression.origin);\n  return resultExpression;\n}\n\nexport default {\n  bind (options, callback, animation) {\n    if (!options) {\n      throw new Error('should pass options for binding');\n    }\n\n    options.exitExpression = formatExpression(options.exitExpression);\n\n    if (options.props) {\n      options.props.forEach((prop) => {\n        prop.expression = formatExpression(prop.expression);\n      });\n    }\n    \n    return Binding.bind(options, callback, animation)\n  },\n  unbind(options) {\n    if (!options) {\n      throw new Error('should pass options for binding');\n    }\n    return Binding.unbind(options);\n  },\n  unbindAll() {\n    return Binding.unbindAll();\n  }\n}","/**\n Copyright 2018 Alibaba Group\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n\n'use strict';\n\nfunction toNumber(value) {\n  return Number(value);\n}\n\nfunction toBoolean(value) {\n  return !!value;\n}\n\n\nfunction equal(v1, v2) {\n  return v1 == v2;\n}\n\nfunction strictlyEqual(v1, v2) {\n  return v1 === v2;\n}\n\nfunction execute(node, scope) {\n\n  let type = node.type;\n  let children = node.children;\n  switch (type) {\n    case 'StringLiteral':\n      return String(node.value);\n    case 'NumericLiteral':\n      return parseFloat(node.value);\n    case 'BooleanLiteral':\n      return !!node.value;\n    case 'Identifier':\n      return scope[node.value];\n    case 'CallExpression':\n      let fn = execute(children[0], scope);\n      let args = [];\n      let jsonArguments = children[1].children;\n      for (let i = 0; i < jsonArguments.length; i++) {\n        args.push(execute(jsonArguments[i], scope));\n      }\n      return fn.apply(null, args);\n    case '?':\n      if (execute(children[0], scope)) {\n        return execute(children[1], scope);\n      }\n      return execute(children[2], scope);\n    case '+':\n      return toNumber(execute(children[0], scope)) + toNumber(execute(children[1], scope));\n    case '-':\n      return toNumber(execute(children[0], scope)) - toNumber(execute(children[1], scope));\n    case '*':\n      return toNumber(execute(children[0], scope)) * toNumber(execute(children[1], scope));\n    case '/':\n      return toNumber(execute(children[0], scope)) / toNumber(execute(children[1], scope));\n    case '%':\n      return toNumber(execute(children[0], scope)) % toNumber(execute(children[1], scope));\n    case '**':\n      return Math.pow(toNumber(execute(children[0], scope)), toNumber(execute(children[1], scope)));\n\n    case '>':\n      return toNumber(execute(children[0], scope)) > toNumber(execute(children[1], scope));\n    case '<':\n      return toNumber(execute(children[0], scope)) < toNumber(execute(children[1], scope));\n    case '>=':\n      return toNumber(execute(children[0], scope)) >= toNumber(execute(children[1], scope));\n    case '<=':\n      return toNumber(execute(children[0], scope)) <= toNumber(execute(children[1], scope));\n\n    case '==':\n      return equal(execute(children[0], scope), execute(children[1], scope));\n    case '===':\n      return strictlyEqual(execute(children[0], scope), execute(children[1], scope));\n    case '!=':\n      return !equal(execute(children[0], scope), execute(children[1], scope));\n    case '!==':\n      return !strictlyEqual(execute(children[0], scope), execute(children[1], scope));\n\n    case '&&':\n      let result;\n      result = execute(children[0], scope);\n      if (!toBoolean(result))\n        return result;\n      return execute(children[1], scope);\n    case '||':\n      result = execute(children[0], scope);\n      if (toBoolean(result))\n        return result;\n      return execute(children[1], scope);\n    case '!':\n      return !toBoolean(execute(children[0], scope));\n\n  }\n  return null;\n}\n\nexport default {\n  execute\n};","/**\n Copyright 2018 Alibaba Group\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n\n'use strict';\n\n// inset function\nfunction colorToDecimal(hexColor) {\n  let hex = hexColor.replace(/'|\"|#/g, '');\n  return parseInt(hex, 16);\n}\n\nfunction decToHex(dec) {\n  let hex = dec.toString(16);\n  let a = [];\n  for (let i = 0; i < 6 - hex.length; i++) {\n    a.push('0');\n  }\n  return a.join('') + hex;\n}\n\n\nfunction parseColor(hexColor) {\n  let hex = hexColor.replace(/'|\"|#/g, '');\n  hex = hex.length === 3 ? [hex[0], hex[0], hex[1], hex[1], hex[2], hex[2]].join('') : hex;\n  let r = `${hex[0]}${hex[1]}`;\n  let g = `${hex[2]}${hex[3]}`;\n  let b = `${hex[4]}${hex[5]}`;\n  return {\n    r,\n    g,\n    b,\n    dr: colorToDecimal(r),\n    dg: colorToDecimal(g),\n    db: colorToDecimal(b)\n  };\n}\n\n\nlet Fn = {\n  max: Math.max,\n  min: Math.min,\n  sin: Math.sin,\n  cos: Math.cos,\n  tan: Math.tan,\n  sqrt: Math.sqrt,\n  cbrt: Math.cbrt,\n  log: Math.log,\n  abs: Math.abs,\n  atan: Math.atan,\n  floor: Math.floor,\n  ceil: Math.ceil,\n  pow: Math.pow,\n  exp: Math.exp,\n  PI: Math.PI,\n  E: Math.E,\n  acos: Math.acos,\n  asin: Math.asin,\n  sign: Math.sign,\n  atan2: Math.atan2,\n  round: Math.round,\n  rgb: function(r, g, b) {\n    return `rgb(${parseInt(r)},${parseInt(g)},${parseInt(b)})`;\n  },\n  rgba: function(r, g, b, a) {\n    return `rgb(${parseInt(r)},${parseInt(g)},${parseInt(b)},${a})`;\n  },\n  getArgs: function() {\n    return arguments;\n  },\n  evaluateColor: function(colorFrom, colorTo, percent) {\n    percent = percent > 1 ? 1 : percent;\n    let from = parseColor(colorFrom);\n    let to = parseColor(colorTo);\n    let dr = parseInt((to.dr - from.dr) * percent + from.dr);\n    let dg = parseInt((to.dg - from.dg) * percent + from.dg);\n    let db = parseInt((to.db - from.db) * percent + from.db);\n    let resDec = dr * 16 * 16 * 16 * 16 + dg * 16 * 16 + db;\n    return `#${decToHex(resDec)}`;\n  },\n\n  svgDrawCmd: function(index, values, cmd) {\n    return {\n      index,\n      values,\n      cmd\n    };\n  },\n  svgDrawCmds: function() {\n    return arguments;\n  },\n  asArray: function() {\n    return [...arguments];\n  }\n};\n\nexport default Fn;","const CubicBezier = function(x1, y1, x2, y2) {\n  this._cx = 3.0 * x1;\n  this._bx = 3.0 * (x2 - x1) - this._cx;\n  this._ax = 1.0 - this._cx - this._bx;\n\n  this._cy = 3.0 * y1;\n  this._by = 3.0 * (y2 - y1) - this._cy;\n  this._ay = 1.0 - this._cy - this._by;\n};\n\nCubicBezier.prototype = {\n  solve: function(x, epsilon) {\n    return this._sampleCurveY(this._solveCurveX(x, epsilon));\n  },\n  _sampleCurveX: function(t) {\n    return ((this._ax * t + this._bx) * t + this._cx) * t;\n  },\n\n  _sampleCurveY: function(t) {\n    return ((this._ay * t + this._by) * t + this._cy) * t;\n  },\n\n  _sampleCurveDerivativeX: function(t) {\n    return (3.0 * this._ax * t + 2.0 * this._bx) * t + this._cx;\n  },\n  // Given an x value, find a parametric value it came from.\n  _solveCurveX: function(x, epsilon) {\n    var t0, t1, t2, x2, d2, i;\n    for (t2 = x, i = 0; i < 8; i++) {\n      x2 = this._sampleCurveX(t2) - x;\n      if (Math.abs(x2) < epsilon)\n        return t2;\n      d2 = this._sampleCurveDerivativeX(t2);\n      if (Math.abs(d2) < 1e-6)\n        break;\n      t2 = t2 - x2 / d2;\n    }\n\n    // Fall back to the bisection method for reliability.\n    t0 = 0.0;\n    t1 = 1.0;\n    t2 = x;\n\n    if (t2 < t0)\n      return t0;\n    if (t2 > t1)\n      return t1;\n\n    while (t0 < t1) {\n      x2 = this._sampleCurveX(t2);\n      if (Math.abs(x2 - x) < epsilon)\n        return t2;\n      if (x > x2)\n        t0 = t2;\n      else\n        t1 = t2;\n      t2 = (t1 - t0) * 0.5 + t0;\n    }\n\n    // Failure.\n    return t2;\n  }\n};\n\nmodule.exports = CubicBezier;\n","'use strict';\n\nvar {PI, sin, cos, sqrt, pow} = Math;\nvar c1 = 1.70158;\nvar c2 = c1 * 1.525;\nvar c3 = c1 + 1;\nvar c4 = ( 2 * PI ) / 3;\nvar c5 = ( 2 * PI ) / 4.5;\n\n// x is the fraction of animation progress, in the range 0..1\nfunction bounceOut(x) {\n  var n1 = 7.5625,\n    d1 = 2.75;\n  if (x < 1 / d1) {\n    return n1 * x * x;\n  } else if (x < 2 / d1) {\n    return n1 * (x -= (1.5 / d1)) * x + .75;\n  } else if (x < 2.5 / d1) {\n    return n1 * (x -= (2.25 / d1)) * x + .9375;\n  } else {\n    return n1 * (x -= (2.625 / d1)) * x + .984375;\n  }\n}\n\n\nvar Easing = {\n  linear: function(x) {\n    return x;\n  },\n  easeInQuad: function(x) {\n    return x * x;\n  },\n  easeOutQuad: function(x) {\n    return 1 - ( 1 - x ) * ( 1 - x );\n  },\n  easeInOutQuad: function(x) {\n    return x < 0.5 ?\n      2 * x * x :\n      1 - pow(-2 * x + 2, 2) / 2;\n  },\n  easeInCubic: function(x) {\n    return x * x * x;\n  },\n  easeOutCubic: function(x) {\n    return 1 - pow(1 - x, 3);\n  },\n  easeInOutCubic: function(x) {\n    return x < 0.5 ?\n      4 * x * x * x :\n      1 - pow(-2 * x + 2, 3) / 2;\n  },\n  easeInQuart: function(x) {\n    return x * x * x * x;\n  },\n  easeOutQuart: function(x) {\n    return 1 - pow(1 - x, 4);\n  },\n  easeInOutQuart: function(x) {\n    return x < 0.5 ?\n      8 * x * x * x * x :\n      1 - pow(-2 * x + 2, 4) / 2;\n  },\n  easeInQuint: function(x) {\n    return x * x * x * x * x;\n  },\n  easeOutQuint: function(x) {\n    return 1 - pow(1 - x, 5);\n  },\n  easeInOutQuint: function(x) {\n    return x < 0.5 ?\n      16 * x * x * x * x * x :\n      1 - pow(-2 * x + 2, 5) / 2;\n  },\n  easeInSine: function(x) {\n    return 1 - cos(x * PI / 2);\n  },\n  easeOutSine: function(x) {\n    return sin(x * PI / 2);\n  },\n  easeInOutSine: function(x) {\n    return -( cos(PI * x) - 1 ) / 2;\n  },\n  easeInExpo: function(x) {\n    return x === 0 ? 0 : pow(2, 10 * x - 10);\n  },\n  easeOutExpo: function(x) {\n    return x === 1 ? 1 : 1 - pow(2, -10 * x);\n  },\n  easeInOutExpo: function(x) {\n    return x === 0 ? 0 : x === 1 ? 1 : x < 0.5 ?\n          pow(2, 20 * x - 10) / 2 :\n          ( 2 - pow(2, -20 * x + 10) ) / 2;\n  },\n  easeInCirc: function(x) {\n    return 1 - sqrt(1 - pow(x, 2));\n  },\n  easeOutCirc: function(x) {\n    return sqrt(1 - pow(x - 1, 2));\n  },\n  easeInOutCirc: function(x) {\n    return x < 0.5 ?\n      ( 1 - sqrt(1 - pow(2 * x, 2)) ) / 2 :\n      ( sqrt(1 - pow(-2 * x + 2, 2)) + 1 ) / 2;\n  },\n  easeInElastic: function(x) {\n    return x === 0 ? 0 : x === 1 ? 1 :\n        -pow(2, 10 * x - 10) * sin(( x * 10 - 10.75 ) * c4);\n  },\n  easeOutElastic: function(x) {\n    return x === 0 ? 0 : x === 1 ? 1 :\n        pow(2, -10 * x) * sin(( x * 10 - 0.75 ) * c4) + 1;\n  },\n  easeInOutElastic: function(x) {\n    return x === 0 ? 0 : x === 1 ? 1 : x < 0.5 ?\n          -( pow(2, 20 * x - 10) * sin(( 20 * x - 11.125 ) * c5)) / 2 :\n          pow(2, -20 * x + 10) * sin(( 20 * x - 11.125 ) * c5) / 2 + 1;\n  },\n  easeInBack: function(x) {\n    return c3 * x * x * x - c1 * x * x;\n  },\n  easeOutBack: function(x) {\n    return 1 + c3 * pow(x - 1, 3) + c1 * pow(x - 1, 2);\n  },\n  easeInOutBack: function(x) {\n    return x < 0.5 ?\n      ( pow(2 * x, 2) * ( ( c2 + 1 ) * 2 * x - c2 ) ) / 2 :\n      ( pow(2 * x - 2, 2) * ( ( c2 + 1 ) * ( x * 2 - 2 ) + c2 ) + 2 ) / 2;\n  },\n  easeInBounce: function(x) {\n    return 1 - bounceOut(1 - x);\n  },\n  easeOutBounce: bounceOut,\n  easeInOutBounce: function(x) {\n    return x < 0.5 ?\n      ( 1 - bounceOut(1 - 2 * x) ) / 2 :\n      ( 1 + bounceOut(2 * x - 1) ) / 2;\n  },\n  cubicBezier: function() {\n  }\n};\n\nmodule.exports = Easing;","module.exports = require('./timer');","'use strict';\n\nvar raf = function(callback) {\n    setTimeout(callback, 1000 / 60);\n  };\n\nvar cancelRAF = clearTimeout;\n\nmodule.exports = {\n  raf,\n  cancelRAF\n};\n","'use strict';\n\nvar easing = require('./easing');\nvar Bezier = require('./bezier');\nvar {raf, cancelRAF} = require('./raf');\n\n\nvar TYPES = {\n  START: 'start',\n  END: 'end',\n  RUN: 'run',\n  STOP: 'stop'\n};\n\nvar noop = () => {\n};\n\nvar MIN_DURATION = 1;\n\nfunction Timer(cfg) {\n  this.init(cfg);\n}\n\nTimer.prototype = {\n  init: function(cfg) {\n    this.cfg = Object.assign({\n      easing: 'linear',\n      duration: Infinity,\n      onStart: noop,\n      onRun: noop,\n      onStop: noop,\n      onEnd: noop\n    }, cfg);\n  },\n  run: function() {\n    let {duration, onStart, onRun} = this.cfg;\n    if (duration <= MIN_DURATION) {\n      this.isfinished = true;\n      typeof onRun === 'function' ? onRun({percent: 1}) : null;\n      this.stop();\n    }\n    if (this.isfinished) return;\n    this._hasFinishedPercent = this._stop && this._stop.percent || 0;\n    this._stop = null;\n    this.start = Date.now();\n    this.percent = 0;\n    typeof onStart === 'function' ? onStart({percent: 0, type: TYPES.START}) : null;\n    // epsilon determines the precision of the solved values\n    let epsilon = (1000 / 60 / duration) / 4;\n    let b = this.cfg.bezierArgs;\n\n    if (b && b.length === 4) {\n      this.bezier = this.bezier || new Bezier(b[0], b[1], b[2], b[3]);\n      this.easingFn = function(x) {\n        return this.bezier.solve(x, epsilon);\n      };\n    } else {\n      this.easingFn = easing[this.cfg.easing];\n    }\n\n    // this.easingFn = b && b.length === 4 ? this.bezier.solve(epsilon) : easing[this.cfg.easing];\n    this._run();\n  },\n\n  _run: function() {\n    let {onRun, onStop} = this.cfg;\n    cancelRAF(this._raf);\n    this._raf = raf(() => {\n      this.now = Date.now();\n      this.t = this.now - this.start;\n      this.duration = this.now - this.start >= this.cfg.duration ? this.cfg.duration : this.now - this.start;\n      this.progress = this.easingFn(this.duration / this.cfg.duration);\n      this.percent = this.duration / this.cfg.duration + this._hasFinishedPercent;\n      if (this.percent >= 1 || this._stop) {\n        this.percent = this._stop && this._stop.percent ? this._stop.percent : 1;\n        this.duration = this._stop && this._stop.duration ? this._stop.duration : this.duration;\n\n        if (!this._stop) {\n          typeof onRun === 'function' ? onRun({\n            percent: this.progress,\n            originPercent: this.percent,\n            t: this.t,\n            type: TYPES.RUN\n          }) : null;\n        }\n        \n        typeof onStop === 'function' ? onStop({\n          percent: this.percent,\n          t: this.t,\n          type: TYPES.STOP\n        }) : null;\n\n        if (this.percent >= 1) {\n          this.isfinished = true;\n          this.stop();\n        }\n        return;\n      }\n\n      typeof onRun === 'function' ? onRun({\n        percent: this.progress,\n        originPercent: this.percent,\n        t: this.t,\n        type: TYPES.RUN\n      }) : null;\n\n      this._run();\n    });\n  },\n\n  stop: function() {\n    let {onEnd} = this.cfg;\n    this._stop = {\n      percent: this.percent,\n      now: this.now\n    };\n    typeof onEnd === 'function' ? onEnd({\n      percent: 1,\n      t: this.t,\n      type: TYPES.END\n    }) : null;\n    cancelRAF(this._raf);\n  }\n};\n\nTimer.raf = raf;\nTimer.cancelRAF = cancelRAF;\nmodule.exports = Timer;\n\n\n\n\n","import TimingHandler from './timing';\nexport {\n  TimingHandler\n};","/**\n Copyright 2018 Alibaba Group\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n\n'use strict';\n\nimport Animation from './animation-util/index';\n\nexport default class TimingHandler {\n  constructor(binding) {\n    this.binding = binding;\n    let {props = [], exitExpression} = this.binding.options;\n\n    props.forEach((prop) => {\n      let {expression} = prop;\n      if (expression && expression.transformed && typeof expression.transformed === 'string') {\n        expression.transformed = JSON.parse(expression.transformed);\n      }\n    });\n\n    let exitTransformed;\n    if (exitExpression && exitExpression.transformed) {\n      exitTransformed = JSON.parse(exitExpression.transformed);\n    }\n    let animation = this.animation = new Animation({\n      duration: Infinity,\n      easing: 'linear',\n      onStart: () => {\n        this.binding.callback({state: 'start', t: 0});\n      },\n      onRun: (e) => {\n        if (exitTransformed && this.binding.getValue({t: e.t}, exitTransformed)) {\n          this.animation.stop();\n        }\n        let changes = []\n        props.forEach((prop) => {\n          let change = this.animate({\n            exitTransformed,\n            t: e.t,\n            ...prop\n          })\n          changes.push(change);\n        });\n        this.binding.setProperty(changes);\n        this.binding.callback({state: 'running', t: e.t - 1000 / 60});\n      },\n      onStop: (e) => {\n        this.binding.callback({state: 'exit', t: e.t - 1000 / 60});\n      }\n    });\n    animation.run();\n  }\n\n  animate(args) {\n    let {property, expression, t} = args;\n    let value = this.binding.getValue({t}, expression.transformed);\n    return {property, value}\n  }\n\n  destroy() {\n    if (this.animation) {\n      this.animation.stop();\n    }\n  }\n\n}","/**\n Copyright 2018 Alibaba Group\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n\n'use strict';\n\nvar lex = {\n  InputElementDiv: '<WhiteSpace>|<LineTerminator>|<ReservedWord>|<Identifier>|<NumericLiteral>|<Punctuator>|<StringLiteral>',\n  InputElementRegExp: '<WhiteSpace>|<LineTerminator>|<ReservedWord>|<Identifier>|<NumericLiteral>|<Punctuator>|<StringLiteral>',\n  ReservedWord: '<Keyword>|<NullLiteral>|<BooleanLiteral>',\n  WhiteSpace: /[\\t\\v\\f\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u200A\\u202F\\u205f\\u3000\\uFEFF]/,\n  LineTerminator: /[\\n\\r\\u2028\\u2029]/,\n  Keyword: /new(?![_$a-zA-Z0-9])|void(?![_$a-zA-Z0-9])|delete(?![_$a-zA-Z0-9])|in(?![_$a-zA-Z0-9])|instanceof(?![_$a-zA-Z0-9])|typeof(?![_$a-zA-Z0-9])/,\n  NullLiteral: /null(?![_$a-zA-Z0-9])/,\n  BooleanLiteral: /(?:true|false)(?![_$a-zA-Z0-9])/,\n  Identifier: /[_$a-zA-Z][_$a-zA-Z0-9]*/,\n  Punctuator: /\\/|=>|\\*\\*|>>>=|>>=|<<=|===|!==|>>>|<<|%=|\\*=|-=|\\+=|<=|>=|==|!=|\\^=|\\|=|\\|\\||&&|&=|>>|\\+\\+|--|\\:|}|\\*|&|\\||\\^|!|~|-|\\+|\\?|%|=|>|<|,|;|\\.(?![0-9])|\\]|\\[|\\)|\\(|{/,\n  DivPunctuator: /\\/=|\\//,\n  NumericLiteral: /(?:0[xX][0-9a-fA-F]*|\\.[0-9]+|(?:[1-9]+[0-9]*|0)(?:\\.[0-9]*|\\.)?)(?:[eE][+-]{0,1}[0-9]+)?(?![_$a-zA-Z0-9])/,\n  StringLiteral: /\"(?:[^\"\\n\\\\\\r\\u2028\\u2029]|\\\\(?:['\"\\\\bfnrtv\\n\\r\\u2028\\u2029]|\\r\\n)|\\\\x[0-9a-fA-F]{2}|\\\\u[0-9a-fA-F]{4}|\\\\[^0-9ux'\"\\\\bfnrtv\\n\\\\\\r\\u2028\\u2029])*\"|'(?:[^'\\n\\\\\\r\\u2028\\u2029]|\\\\(?:['\"\\\\bfnrtv\\n\\r\\u2028\\u2029]|\\r\\n)|\\\\x[0-9a-fA-F]{2}|\\\\u[0-9a-fA-F]{4}|\\\\[^0-9ux'\"\\\\bfnrtv\\n\\\\\\r\\u2028\\u2029])*'/,\n  RegularExpressionLiteral: /\\/(?:\\[(?:\\\\[\\s\\S]|[^\\]])*\\]|[^*\\/\\\\\\n\\r\\u2028\\u2029]|\\\\[^\\n\\r\\u2028\\u2029])(?:\\[(?:\\\\[\\s\\S]|[^\\]])*\\]|[^\\/\\\\\\n\\r\\u2028\\u2029]|\\\\[^\\n\\r\\u2028\\u2029])*\\/[0-9a-zA-Z]*/\n};\n\nfunction XRegExp(xregexps, rootname, flag) {\n  var expnames = [rootname];\n\n  function buildRegExp(source) {\n    var regexp = new RegExp;\n    regexp.compile(source.replace(/<([^>]+)>/g,\n      function (all, expname) {\n        if (!xregexps[expname])\n          return '';\n        expnames.push(expname);\n        if (xregexps[expname] instanceof RegExp)\n          return '(' + xregexps[expname].source + ')';\n        return '(' + buildRegExp(xregexps[expname]).source + ')';\n      }), flag);\n    return regexp;\n  }\n\n  var regexp = buildRegExp(xregexps[rootname]);\n  this.exec = function (string) {\n    var matches = regexp.exec(string);\n    if (matches == null)\n      return null;\n    var result = new String(matches[0]);\n    for (var i = 0; i < expnames.length; i++)\n      if (matches[i])\n        result[expnames[i]] = matches[i];\n    return result;\n  };\n  Object.defineProperty(this, 'lastIndex',\n    {\n      'get': function () {\n        return regexp.lastIndex;\n      },\n      'set': function (v) {\n        regexp.lastIndex = v;\n      }\n    });\n}\n\nfunction LexicalParser() {\n  var inputElementDiv = new XRegExp(lex, 'InputElementDiv', 'g');\n  var inputElementRegExp = new XRegExp(lex, 'InputElementRegExp', 'g');\n  var source;\n  Object.defineProperty(this, 'source', {\n    'get': function () {\n      return source;\n    },\n    'set': function (v) {\n      source = v;\n      inputElementDiv.lastIndex = 0;\n      inputElementRegExp.lastIndex = 0;\n    }\n  });\n  this.reset = function () {\n    inputElementDiv.lastIndex = 0;\n    inputElementRegExp.lastIndex = 0;\n  };\n  this.getNextToken = function (useDiv) {\n    var lastIndex = inputElementDiv.lastIndex;\n    var inputElement;\n    if (useDiv)\n      inputElement = inputElementDiv;\n    else\n      inputElement = inputElementRegExp;\n    var token = inputElement.exec(source);\n    if (token && inputElement.lastIndex - lastIndex > token.length) {\n      throw new SyntaxError('Unexpected token ILLEGAL');\n    }\n    inputElementDiv.lastIndex = inputElement.lastIndex;\n    inputElementRegExp.lastIndex = inputElement.lastIndex;\n    return token;\n  };\n}\n\nvar rules = {\n  'IdentifierName': [['Identifier']],\n  'Literal': [['NullLiteral'], ['BooleanLiteral'], ['NumericLiteral'], ['StringLiteral'], ['RegularExpressionLiteral']],\n  'PrimaryExpression': [['Identifier'], ['Literal'], ['(', 'Expression', ')']],\n  'CallExpression': [['PrimaryExpression', 'Arguments'], ['CallExpression', 'Arguments']],\n  'Arguments': [['(', ')'], ['(', 'ArgumentList', ')']],\n  'ArgumentList': [['ConditionalExpression'], ['ArgumentList', ',', 'ConditionalExpression']],\n  'LeftHandSideExpression': [['PrimaryExpression'], ['CallExpression']],\n  'UnaryExpression': [['LeftHandSideExpression'], ['void', 'UnaryExpression'], ['+', 'UnaryExpression'], ['-', 'UnaryExpression'], ['~', 'UnaryExpression'], ['!', 'UnaryExpression']],\n  'ExponentiationExpression': [['UnaryExpression'], ['ExponentiationExpression', '**', 'UnaryExpression']],\n  'MultiplicativeExpression': [['MultiplicativeExpression', '/', 'ExponentiationExpression'], ['ExponentiationExpression'], ['MultiplicativeExpression', '*', 'ExponentiationExpression'], ['MultiplicativeExpression', '%', 'ExponentiationExpression']],\n  'AdditiveExpression': [['MultiplicativeExpression'], ['AdditiveExpression', '+', 'MultiplicativeExpression'], ['AdditiveExpression', '-', 'MultiplicativeExpression']],\n  'ShiftExpression': [['AdditiveExpression'], ['ShiftExpression', '<<', 'AdditiveExpression'], ['ShiftExpression', '>>', 'AdditiveExpression'], ['ShiftExpression', '>>>', 'AdditiveExpression']],\n  'RelationalExpression': [['ShiftExpression'], ['RelationalExpression', '<', 'ShiftExpression'], ['RelationalExpression', '>', 'ShiftExpression'], ['RelationalExpression', '<=', 'ShiftExpression'], ['RelationalExpression', '>=', 'ShiftExpression'], ['RelationalExpression', 'instanceof', 'ShiftExpression'], ['RelationalExpression', 'in', 'ShiftExpression']],\n  'EqualityExpression': [['RelationalExpression'], ['EqualityExpression', '==', 'RelationalExpression'], ['EqualityExpression', '!=', 'RelationalExpression'], ['EqualityExpression', '===', 'RelationalExpression'], ['EqualityExpression', '!==', 'RelationalExpression']],\n  'BitwiseANDExpression': [['EqualityExpression'], ['BitwiseANDExpression', '&', 'EqualityExpression']],\n  'BitwiseXORExpression': [['BitwiseANDExpression'], ['BitwiseXORExpression', '^', 'BitwiseANDExpression']],\n  'BitwiseORExpression': [['BitwiseXORExpression'], ['BitwiseORExpression', '|', 'BitwiseXORExpression']],\n  'LogicalANDExpression': [['BitwiseORExpression'], ['LogicalANDExpression', '&&', 'BitwiseORExpression']],\n  'LogicalORExpression': [['LogicalANDExpression'], ['LogicalORExpression', '||', 'LogicalANDExpression']],\n  'ConditionalExpression': [['LogicalORExpression'], ['LogicalORExpression', '?', 'LogicalORExpression', ':', 'LogicalORExpression']],\n  'Expression': [['ConditionalExpression'], ['Expression', ',', 'ConditionalExpression']],\n  'Program': [['Expression']]\n\n};\n\nfunction Symbol(symbolName, token) {\n  this.name = symbolName;\n  this.token = token;\n  this.childNodes = [];\n  this.toString = function (indent) {\n    if (!indent)\n      indent = '';\n    if (this.childNodes.length == 1)\n      return this.childNodes[0].toString(indent);\n    var str = indent + this.name + (this.token != undefined && this.name != this.token ? ':' + this.token : '') + '\\n';\n    for (var i = 0; i < this.childNodes.length; i++)\n      str += this.childNodes[i].toString(indent + '    ');\n    return str;\n  };\n}\n\nfunction SyntacticalParser() {\n  var currentRule;\n  var root = {\n    Program: '$'\n  };\n  var hash = {};\n\n  function closureNode(node) {\n\n    hash[JSON.stringify(node)] = node;\n\n    var queue = Object.getOwnPropertyNames(node);\n    while (queue.length) {\n      var symbolName = queue.shift();\n      if (!rules[symbolName])\n        continue;\n      rules[symbolName].forEach(function (rule) {\n        if (!node[rule[0]])\n          queue.push(rule[0]);\n        var rulenode = node;\n        var lastnode = null;\n        rule.forEach(function (symbol) {\n          if (!rulenode[symbol])\n            rulenode[symbol] = {};\n          lastnode = rulenode;\n          rulenode = rulenode[symbol];\n        });\n        if (node[symbolName].$div)\n          rulenode.$div = true;\n        rulenode.$reduce = symbolName;\n        rulenode.$count = rule.length;\n      });\n    }\n\n    for (var p in node) {\n      if (typeof node[p] != 'object' || p.charAt(0) == '$' || node[p].$closure)\n        continue;\n      if (hash[JSON.stringify(node[p])])\n        node[p] = hash[JSON.stringify(node[p])];\n      else {\n        closureNode(node[p]);\n      }\n    }\n    node.$closure = true;\n  }\n\n  closureNode(root);\n  var symbolStack = [];\n  var statusStack = [root];\n  var current = root;\n  this.insertSymbol = function insertSymbol(symbol, haveLineTerminator) {\n    while (!current[symbol.name] && current.$reduce) {\n      var count = current.$count;\n      var newsymbol = new Symbol(current.$reduce);\n      while (count--)\n        newsymbol.childNodes.push(symbolStack.pop()), statusStack.pop();\n      current = statusStack[statusStack.length - 1];\n      this.insertSymbol(newsymbol);\n    }\n    current = current[symbol.name];\n    symbolStack.push(symbol), statusStack.push(current);\n    if (!current)\n      throw new Error();\n    return current.$div;\n  };\n  this.reset = function () {\n    current = root;\n    symbolStack = [];\n    statusStack = [root];\n  };\n  Object.defineProperty(this, 'grammarTree', {\n    'get': function () {\n      try {\n        while (current.$reduce) {\n          var count = current.$count;\n          var newsymbol = new Symbol(current.$reduce);\n          while (count--)\n            newsymbol.childNodes.push(symbolStack.pop()), statusStack.pop();\n          current = statusStack[statusStack.length - 1];\n          this.insertSymbol(newsymbol);\n        }\n        if (symbolStack.length > 0 && current[';']) {\n          this.insertSymbol(new Symbol(';', ';'));\n          return this.grammarTree;\n        }\n        if (symbolStack.length != 1 || symbolStack[0].name != 'Program')\n          throw new Error();\n      } catch (e) {\n        throw new SyntaxError('Unexpected end of input');\n      }\n      return symbolStack[0];\n    }\n  });\n}\n\nfunction Parser() {\n  this.lexicalParser = new LexicalParser();\n  this.syntacticalParser = new SyntacticalParser();\n  var terminalSymbols = ['NullLiteral', 'BooleanLiteral', 'NumericLiteral', 'StringLiteral', 'RegularExpressionLiteral', 'Identifier', '**', '=>', '{', '}', '(', ')', '[', ']', '.', ';', ',', '<', '>', '<=', '>=', '==', '!=', '===', '!==', '+', '-', '*', '%', '++', '--', '<<', '>>', '>>>', '&', '|', '^', '!', '~', '&&', '||', '?', ':', '=', '+=', '-=', '*=', '%=', '<<=', '>>=', '>>>=', '&=', '|=', '^=', '/', '/=', 'instanceof', 'typeof', 'new', 'void', 'debugger', 'this', 'delete', 'in'];\n  var terminalSymbolIndex = {};\n  terminalSymbols.forEach(function (e) {\n    Object.defineProperty(terminalSymbolIndex, e, {});\n  });\n  this.reset = function () {\n    this.lexicalParser.reset();\n    this.syntacticalParser.reset();\n  };\n  this.parse = function (source, onInputElement) {\n    var token;\n    var haveLineTerminator = false;\n    this.lexicalParser.source = source;\n    var useDiv = false;\n    while (token = this.lexicalParser.getNextToken(useDiv)) {\n      if (onInputElement)\n        onInputElement(token);\n      try {\n        if (Object.getOwnPropertyNames(token).some(\n            (e) => {\n            if (terminalSymbolIndex.hasOwnProperty(e)) {\n          useDiv = this.syntacticalParser.insertSymbol(new Symbol(e, token), haveLineTerminator);\n          haveLineTerminator = false;\n          return true;\n        } else\n          return false;\n      }))\n        continue;\n        if ((token.Keyword || token.Punctuator || token.DivPunctuator) && terminalSymbolIndex.hasOwnProperty(token.toString())) {\n          useDiv = this.syntacticalParser.insertSymbol(new Symbol(token.toString(), token), haveLineTerminator);\n        }\n      } catch (e) {\n        throw new SyntaxError('Unexpected token ' + token);\n      }\n    }\n    return this.syntacticalParser.grammarTree;\n  };\n}\n\nvar parser = new Parser();\n\nfunction JavaScriptExpression(text) {\n  parser.reset();\n  this.tree = (parser.parse(text));\n  this.paths = [];\n  var context = Object.create(null);\n  var me = this;\n  var pathIndex = Object.create(null);\n  this.isSimple;\n  this.isConst;\n  walk(this.tree);\n  checkSimple(this.tree);\n  if (this.paths.length === 0) {\n    this.isConst = true;\n  }\n  this.setter = function (path) {\n    var curr = context;\n    for (var i = 0; i < path.length - 1; i++) {\n      if (!curr[path[i]])\n        curr[path[i]] = Object.create(null);\n      curr = curr[path[i]];\n    }\n    return {\n      isCompleted: function () {\n        for (var p in pathIndex)\n          if (!pathIndex[p])\n            return false;\n        return true;\n      },\n      set: function (value) {\n        if (!pathIndex[path.join('.')]) {\n          pathIndex[path.join('.')] = true;\n        }\n        curr[path[i]] = (value);\n        if (this.isCompleted()) {\n          return me.exec();\n        } else {\n          return undefined;\n        }\n      }\n    };\n  };\n\n  this.valueOf = this.exec = function () {\n    try {\n      return function () {\n        return eval(text);\n      }.call(context);\n    } catch (e) {\n    }\n  };\n\n  function checkSimple(symbol) {\n\n    var curr = symbol;\n    while (curr.childNodes.length <= 1 && curr.name !== 'MemberExpression') {\n      curr = curr.childNodes[0];\n    }\n    // TODO: need to point out \"[……]\"\n    if (curr.name === 'MemberExpression') {\n      me.isSimple = true;\n    } else {\n      me.isSimple = false;\n    }\n  }\n\n  function walk(symbol) {\n    if (symbol.name === 'CallExpression' && symbol.childNodes[symbol.childNodes.length - 1].name !== 'CallExpression') {\n      var path = getPath(symbol.childNodes[1]);\n      walk(symbol.childNodes[0]);\n    } else if (symbol.name === 'NewExpression' && symbol.childNodes.length === 1) {\n      var path = getPath(symbol.childNodes[0]);\n    } else if (symbol.name === 'MemberExpression' && symbol.childNodes.length === 1) {\n      var path = getPath(symbol);\n    } else {\n      for (var i = 0; i < symbol.childNodes.length; i++)\n        walk(symbol.childNodes[i]);\n    }\n\n  }\n\n\n  function getPath(symbol) {\n    // [[\"PrimaryExpression\"], [\"MemberExpression\", \"[\", \"Expression\", \"]\"], [\"MemberExpression\", \".\", \"IdentifierName\"], [\"new\", \"MemberExpression\", \"Arguments\"]],\n\n    if (symbol.childNodes[0].name === 'IdentifierName') { // MemberExpression : MemberExpression \".\" IdentifierName\n      var path = getPath(symbol.childNodes[2]);\n      if (path)\n        path = path.concat(symbol.childNodes[0].childNodes[0].token.toString());\n      createPath(path);\n      return path;\n\n    } else if (symbol.childNodes[0].name === 'PrimaryExpression') { // MemberExpression : PrimaryExpression\n      if (symbol.childNodes[0].childNodes[0].name === 'Identifier') {\n        var path = [symbol.childNodes[0].childNodes[0].token.toString()];\n        createPath(path);\n        return path;\n      } else {\n        return null;\n      }\n    } else if (symbol.childNodes[0].name === ']') { // MemberExpression : MemberExpression \"[\" Expression \"]\"\n      getPath(symbol.childNodes[3]);\n      walk(symbol.childNodes[1]);\n      return null;\n\n    } else if (symbol.childNodes[0].name === 'Arguments') { // MemberExpression : \"new\" MemberExpression Arguments\n      walk(symbol.childNodes[0]);\n      walk(symbol.childNodes[1]);\n      return null;\n    } else {\n      for (var i = 0; i < symbol.childNodes.length; i++)\n        walk(symbol.childNodes[i]);\n    }\n  }\n\n\n  function createPath(path) {\n    var curr = context;\n    for (var i = 0; i < path.length - 1; i++) {\n      if (!curr[path[i]])\n        curr[path[i]] = Object.create(null);\n      curr = curr[path[i]];\n    }\n    me.paths.push(path);\n    pathIndex[path.join('.')] = false;\n  }\n}\n\nfunction visit(tree) {\n  var childNodes = tree.childNodes.slice().reverse();\n  var children = childNodes.filter(e =>\n    !e.token || !e.token.Punctuator);\n  if (tree.name === 'UnaryExpression') {\n    // negative number support\n    if (childNodes.length === 2 && childNodes[0].name === '-' && children.length === 1) {\n      var res = visit(children[0]);\n      res.value = -res.value;\n      return res;\n    }\n  }\n\n  if (tree.name === 'Arguments') {\n    var argumentList = [];\n    var listNode = children[0];\n    while (listNode) {\n      if (listNode.childNodes.length === 3) {\n        argumentList.unshift(listNode.childNodes[0]);\n        listNode = listNode.childNodes[2];\n      }\n      if (listNode.childNodes.length === 1) {\n        argumentList.unshift(listNode.childNodes[0]);\n        listNode = null;\n      }\n    }\n    return {\n      type: 'Arguments',\n      children: argumentList.map(e => visit(e))\n  };\n  }\n\n\n  if (children && children.length === 1) {\n    var res = visit(children[0]);\n    return res;\n  }\n\n  if (tree.token && ['NullLiteral', 'BooleanLiteral', 'NumericLiteral', 'StringLiteral', 'Identifier'].some(e => tree.token[e])) {\n    var type = Object.keys(tree.token).filter(e => e.match(/Literal/) || e.match(/Identifier/))[0];\n    var value = {\n      'NullLiteral': null,\n      'BooleanLiteral': Boolean(tree.token),\n      'NumericLiteral': Number(tree.token),\n      'StringLiteral': tree.token,\n      'Identifier': tree.token,\n    }[type];\n\n    return {\n      type: type,\n      value: value\n    };\n  }\n\n  if (tree.name === 'CallExpression')\n    return {\n      type: 'CallExpression',\n      children: [visit(childNodes[0]), visit(childNodes[1])]\n    };\n\n  return {\n    type: childNodes.filter(e => e.token && e.token.Punctuator)[0].name,\n    children: childNodes.filter(e => !e.token || !e.token.Punctuator).map(e => visit(e))\n};\n}\n\nfunction parse(originExp) {\n  var exp = new JavaScriptExpression(originExp);\n  return JSON.stringify(visit(exp.tree), null);\n}\n\nexport default {\n  parse\n}"],"sourceRoot":""}